<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light">
    <title>福签 · AI新年祝福生成器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Serif+SC:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <style>
:root {
    --color-bg: #F8F3EB;
    --color-bg-warm: #F5EDE0;
    --color-surface: #FFFFFF;
    --color-primary: #E85D50;
    --color-primary-hover: #D64A3D;
    --color-primary-light: #FFEBE9;
    --color-accent: #C94A3E;
    --color-text: #2D2A26;
    --color-text-secondary: #6B6560;
    --color-text-tertiary: #9A9590;
    --color-border: #E8E0D5;
    --color-border-light: #F0EAE0;
    --color-success: #4A9D6B;
    --color-lantern: #E85D50;
    --color-lantern-light: #F5A89F;
    --font-display: "Noto Serif SC", serif;
    --font-body: "Inter", "Noto Sans SC", system-ui, sans-serif;
    --space-1: 4px; --space-2: 8px; --space-3: 12px; --space-4: 16px;
    --space-5: 24px; --space-6: 32px; --space-7: 48px; --space-8: 64px;
    --radius-sm: 4px; --radius-md: 8px; --radius-lg: 12px; --radius-xl: 16px;
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
    --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
    --ease-out: cubic-bezier(0.33, 1, 0.68, 1);
    --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { font-size: 16px; -webkit-font-smoothing: antialiased; }
body {
    font-family: var(--font-body);
    background: var(--color-bg);
    color: var(--color-text);
    min-height: 100vh;
    line-height: 1.6;
    position: relative;
    overflow-x: hidden;
}
body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    opacity: 0.035;
    pointer-events: none;
    z-index: 0;
}
/* 灯笼装饰 */
.lantern-decor {
    position: fixed;
    top: -20px;
    pointer-events: none;
    z-index: 1;
}
.lantern-decor.left { left: 5%; }
.lantern-decor.right { right: 8%; }
.lantern {
    width: 60px;
    height: 80px;
    position: relative;
}
.lantern-body {
    width: 100%;
    height: 60px;
    background: radial-gradient(ellipse at 50% 30%, var(--color-lantern-light) 0%, var(--color-lantern) 60%, var(--color-accent) 100%);
    border-radius: 50% 50% 45% 45%;
    position: relative;
    box-shadow: inset 0 -10px 20px rgba(0,0,0,0.15);
}
.lantern-body::before {
    content: '';
    position: absolute;
    top: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 70%;
    height: 8px;
    background: linear-gradient(180deg, rgba(255,255,255,0.4), transparent);
    border-radius: 50%;
}
.lantern-top {
    width: 24px;
    height: 8px;
    background: linear-gradient(180deg, #D4A574, #B8956A);
    margin: 0 auto;
    border-radius: 2px 2px 0 0;
}
.lantern-string {
    width: 1px;
    height: 30px;
    background: linear-gradient(180deg, #B8956A, transparent);
    margin: 0 auto;
}
.lantern-tassel {
    width: 2px;
    height: 40px;
    background: linear-gradient(180deg, var(--color-lantern), var(--color-accent));
    margin: 0 auto;
    position: relative;
}
.lantern-tassel::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 8px;
    height: 8px;
    background: var(--color-accent);
    border-radius: 50%;
}
@keyframes lanternSway {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
}
.lantern-decor { animation: lanternSway 4s ease-in-out infinite; }
.lantern-decor.right { animation-delay: -2s; }
/* 布局 */
.page-wrapper {
    position: relative;
    z-index: 2;
    min-height: 100vh;
    padding: var(--space-5);
    display: flex;
    flex-direction: column;
    align-items: center;
}
.container {
    width: 100%;
    max-width: 480px;
}
/* Header */
.site-header {
    text-align: center;
    margin-bottom: var(--space-6);
    padding-top: var(--space-5);
}
.brand {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
    margin-bottom: var(--space-2);
}
.brand-icon {
    width: 36px;
    height: 36px;
    color: var(--color-primary);
}
.brand-name {
    font-family: var(--font-display);
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--color-text);
    letter-spacing: 0.1em;
}
.brand-tagline {
    font-size: 0.8125rem;
    color: var(--color-text-tertiary);
    letter-spacing: 0.2em;
}
.year-label {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    margin-top: var(--space-3);
    padding: var(--space-1) var(--space-3);
    background: var(--color-primary-light);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    color: var(--color-primary);
    font-weight: 500;
}
/* API配置区 */
.api-config {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin-bottom: var(--space-5);
}
.api-config-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-3);
}
.api-config-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-secondary);
}
.api-config-title i { width: 16px; height: 16px; }
.api-status {
    display: flex;
    align-items: center;
    gap: var(--space-1);
    font-size: 0.75rem;
    color: var(--color-text-tertiary);
}
.api-status.connected { color: var(--color-success); }
.api-status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--color-text-tertiary);
}
.api-status.connected .api-status-dot { background: var(--color-success); }
.api-input-group {
    display: flex;
    gap: var(--space-2);
}
.api-input {
    flex: 1;
    padding: var(--space-3);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-family: monospace;
    background: var(--color-bg);
    transition: border-color 0.2s;
}
.api-input:focus {
    outline: none;
    border-color: var(--color-primary);
}
.api-input::placeholder { color: var(--color-text-tertiary); }
.btn-api-save {
    padding: var(--space-3) var(--space-4);
    background: var(--color-text);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}
.btn-api-save:hover { background: #1a1a1a; }
/* 表单卡片 */
.form-card {
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--space-5);
    margin-bottom: var(--space-5);
}
.form-section {
    margin-bottom: var(--space-5);
}
.form-section:last-child { margin-bottom: 0; }
.form-section-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: var(--space-3);
    padding-bottom: var(--space-2);
    border-bottom: 1px solid var(--color-border-light);
}
.form-section-title i { width: 16px; height: 16px; color: var(--color-primary); }
.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-3);
    margin-bottom: var(--space-3);
}
.form-row.single { grid-template-columns: 1fr; }
.form-group { margin-bottom: var(--space-3); }
.form-group:last-child { margin-bottom: 0; }
.form-label {
    display: block;
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    margin-bottom: var(--space-2);
}
.form-label .required {
    color: var(--color-primary);
    margin-left: 2px;
}
.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: var(--space-3);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: 0.9375rem;
    font-family: var(--font-body);
    background: var(--color-bg);
    color: var(--color-text);
    transition: all 0.2s;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--color-primary);
    background: var(--color-surface);
    box-shadow: 0 0 0 3px var(--color-primary-light);
}
.form-input::placeholder, .form-textarea::placeholder { color: var(--color-text-tertiary); }
.form-select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236B6560' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 40px;
    cursor: pointer;
}
.form-textarea {
    min-height: 80px;
    resize: vertical;
    line-height: 1.5;
}
/* 单选按钮组 */
.radio-group {
    display: flex;
    gap: var(--space-2);
    flex-wrap: wrap;
}
.radio-item {
    position: relative;
}
.radio-item input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}
.radio-item label {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    background: var(--color-bg);
}
.radio-item input:checked + label {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
}
.radio-item label:hover {
    border-color: var(--color-primary);
}
/* 按钮 */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-4) var(--space-5);
    border-radius: var(--radius-md);
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s var(--ease-out);
    min-height: 52px;
    border: none;
    width: 100%;
}
.btn:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
}
.btn-primary {
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(232, 93, 80, 0.3);
}
.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(232, 93, 80, 0.4);
}
.btn-primary:active { transform: translateY(0) scale(0.98); }
.btn-primary:disabled {
    background: var(--color-text-tertiary);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
.btn-secondary {
    background: transparent;
    color: var(--color-text-secondary);
    border: 1px solid var(--color-border);
}
.btn-secondary:hover {
    background: var(--color-surface);
    border-color: var(--color-text-tertiary);
}
.btn-icon { width: 18px; height: 18px; flex-shrink: 0; }
/* 结果展示区 */
.result-card {
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--space-6);
    margin-bottom: var(--space-5);
    display: none;
    position: relative;
    overflow: hidden;
}
.result-card.visible { display: block; }
.result-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--color-primary), var(--color-lantern-light), var(--color-primary));
}
.result-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: var(--space-4);
}
.result-title {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-secondary);
}
.result-title i { width: 16px; height: 16px; color: var(--color-primary); }
.result-content {
    font-family: var(--font-display);
    font-size: 1.25rem;
    line-height: 2;
    color: var(--color-text);
    letter-spacing: 0.02em;
    white-space: pre-wrap;
}
.result-content.animate {
    animation: fadeInUp 0.5s var(--ease-spring);
}
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
.result-actions {
    display: flex;
    gap: var(--space-3);
    margin-top: var(--space-5);
    padding-top: var(--space-4);
    border-top: 1px solid var(--color-border-light);
}
.result-actions .btn { flex: 1; min-height: 44px; }
.btn-copy.success {
    background: var(--color-success);
    border-color: var(--color-success);
    color: white;
}
/* 加载状态 */
.loading-overlay {
    position: fixed;
    inset: 0;
    background: rgba(248, 243, 235, 0.9);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 100;
}
.loading-overlay.visible { display: flex; }
.loading-content {
    text-align: center;
}
.loading-spinner {
    width: 48px;
    height: 48px;
    border: 3px solid var(--color-border);
    border-top-color: var(--color-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto var(--space-4);
}
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text {
    font-size: 0.9375rem;
    color: var(--color-text-secondary);
}
/* 模式切换 */
.mode-toggle {
    display: flex;
    background: var(--color-border-light);
    border-radius: var(--radius-md);
    padding: 3px;
    margin-bottom: var(--space-5);
}
.mode-btn {
    flex: 1;
    padding: var(--space-3);
    border: none;
    background: transparent;
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
}
.mode-btn i { width: 16px; height: 16px; }
.mode-btn.active {
    background: var(--color-surface);
    color: var(--color-text);
    box-shadow: var(--shadow-sm);
}
/* 随机模式卡片 */
.random-card {
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    padding: var(--space-6);
    margin-bottom: var(--space-5);
    text-align: center;
    display: none;
}
.random-card.visible { display: block; }
.random-wish {
    font-family: var(--font-display);
    font-size: 1.5rem;
    line-height: 1.8;
    color: var(--color-text);
    margin-bottom: var(--space-5);
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.random-wish.placeholder { color: var(--color-text-tertiary); font-weight: 400; }
/* Footer */
.site-footer {
    text-align: center;
    padding: var(--space-5) 0;
}
.footer-text {
    font-size: 0.75rem;
    color: var(--color-text-tertiary);
    letter-spacing: 0.1em;
}
/* 响应式 */
@media (max-width: 640px) {
    .form-row { grid-template-columns: 1fr; }
    .lantern-decor { display: none; }
    .result-actions { flex-direction: column; }
}
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
    }
}
</style>
</head>
<body>
    <!-- 灯笼装饰 -->
    <div class="lantern-decor left">
        <div class="lantern">
            <div class="lantern-string"></div>
            <div class="lantern-top"></div>
            <div class="lantern-body"></div>
            <div class="lantern-tassel"></div>
        </div>
    </div>
    <div class="lantern-decor right">
        <div class="lantern">
            <div class="lantern-string"></div>
            <div class="lantern-top"></div>
            <div class="lantern-body"></div>
            <div class="lantern-tassel"></div>
        </div>
    </div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">AI正在为您撰写祝福...</p>
        </div>
    </div>

    <main class="page-wrapper">
        <div class="container">
            <!-- Header -->
            <header class="site-header">
                <div class="brand">
                    <svg class="brand-icon" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="2" y="2" width="32" height="32" rx="6" stroke="currentColor" stroke-width="2.5"/>
                        <path d="M9 13h18M18 9v18M11 20h14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>
                    <h1 class="brand-name">福签</h1>
                </div>
                <p class="brand-tagline">AI新年祝福生成器</p>
                <div class="year-label">乙巳蛇年 · 2025</div>
            </header>

            <!-- API配置 -->
            <section class="api-config">
                <div class="api-config-header">
                    <div class="api-config-title">
                        <i data-lucide="key"></i>
                        <span>智谱API配置</span>
                    </div>
                    <div class="api-status" id="apiStatus">
                        <span class="api-status-dot"></span>
                        <span id="apiStatusText">未配置</span>
                    </div>
                </div>
                <div class="api-input-group">
                    <input type="password" class="api-input" id="apiKeyInput" placeholder="输入您的智谱API Key">
                    <button class="btn-api-save" id="saveApiBtn">确定</button>
                </div>
            </section>

            <!-- 模式切换 -->
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="ai" id="modeAi">
                    <i data-lucide="sparkles"></i>
                    <span>AI定制祝福</span>
                </button>
                <button class="mode-btn" data-mode="random" id="modeRandom">
                    <i data-lucide="shuffle"></i>
                    <span>随机福签</span>
                </button>
            </div>

            <!-- AI模式表单 -->
            <section class="form-card" id="aiFormCard">
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i data-lucide="user"></i>
                        <span>祝福对象</span>
                    </h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">姓名/称呼<span class="required">*</span></label>
                            <input type="text" class="form-input" id="recipientName" placeholder="如：妈妈、张总、小明">
                        </div>
                        <div class="form-group">
                            <label class="form-label">性别</label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="gender" id="genderMale" value="男">
                                    <label for="genderMale">男</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="gender" id="genderFemale" value="女">
                                    <label for="genderFemale">女</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="gender" id="genderNone" value="" checked>
                                    <label for="genderNone">不指定</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">与您的关系<span class="required">*</span></label>
                        <select class="form-select" id="relationship">
                            <option value="">请选择</option>
                            <option value="父母">父母</option>
                            <option value="爱人/伴侣">爱人/伴侣</option>
                            <option value="子女">子女</option>
                            <option value="兄弟姐妹">兄弟姐妹</option>
                            <option value="朋友">朋友</option>
                            <option value="同事">同事</option>
                            <option value="领导/上司">领导/上司</option>
                            <option value="客户/合作伙伴">客户/合作伙伴</option>
                            <option value="老师">老师</option>
                            <option value="学生">学生</option>
                            <option value="长辈">长辈</option>
                            <option value="晚辈">晚辈</option>
                        </select>
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="form-section-title">
                        <i data-lucide="heart"></i>
                        <span>情感细节（选填，让祝福更走心）</span>
                    </h3>
                    <div class="form-group">
                        <label class="form-label">对方的特点/爱好</label>
                        <input type="text" class="form-input" id="traits" placeholder="如：热爱旅行、工作认真、喜欢美食">
                    </div>
                    <div class="form-group">
                        <label class="form-label">难忘的回忆/共同经历</label>
                        <textarea class="form-textarea" id="memory" placeholder="如：去年一起去云南旅行、帮我度过了困难时期..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">新年期望/祝愿</label>
                        <input type="text" class="form-input" id="wishes" placeholder="如：希望身体健康、事业更上一层楼">
                    </div>
                </div>

                <div class="form-section">
                    <h3 class="form-section-title">
                        <i data-lucide="palette"></i>
                        <span>祝福风格</span>
                    </h3>
                    <div class="form-group">
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="style" id="styleWarm" value="温馨" checked>
                                <label for="styleWarm">温馨</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="style" id="styleFormal" value="正式">
                                <label for="styleFormal">正式</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="style" id="styleHumor" value="幽默">
                                <label for="styleHumor">幽默</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="style" id="styleLiterary" value="文艺">
                                <label for="styleLiterary">文艺</label>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" id="generateAiBtn" type="button">
                    <i data-lucide="wand-2" class="btn-icon"></i>
                    <span>生成专属祝福</span>
                </button>
            </section>

            <!-- 随机模式卡片 -->
            <section class="random-card" id="randomCard">
                <p class="random-wish placeholder" id="randomWishText">点击下方按钮，求取新年福签</p>
                <button class="btn btn-primary" id="generateRandomBtn" type="button">
                    <i data-lucide="sparkles" class="btn-icon"></i>
                    <span>求签</span>
                </button>
            </section>

            <!-- 结果展示 -->
            <section class="result-card" id="resultCard">
                <div class="result-header">
                    <div class="result-title">
                        <i data-lucide="gift"></i>
                        <span>您的专属祝福</span>
                    </div>
                </div>
                <div class="result-content" id="resultContent"></div>
                <div class="result-actions">
                    <button class="btn btn-secondary btn-copy" id="copyResultBtn" type="button">
                        <i data-lucide="copy" class="btn-icon"></i>
                        <span>复制</span>
                    </button>
                    <button class="btn btn-secondary" id="regenerateBtn" type="button">
                        <i data-lucide="refresh-cw" class="btn-icon"></i>
                        <span>重新生成</span>
                    </button>
                </div>
            </section>

            <!-- Footer -->
            <footer class="site-footer">
                <p class="footer-text">愿好运与你相伴 · 新春快乐</p>
            </footer>
        </div>
    </main>

    <script>
        // 初始化Lucide图标
        lucide.createIcons();

        // ========================================
        // 随机祝福语库
        // ========================================
        const randomWishes = [
            "蛇年大吉，万事如意", "新春快乐，阖家幸福", "恭喜发财，财源广进",
            "金蛇献瑞，福满人间", "蛇舞新春，吉祥如意", "瑞蛇迎春，幸福安康",
            "前程似锦，步步高升", "身体健康，万事顺心", "岁岁平安，年年有余",
            "吉星高照，鸿运当头", "五福临门，六六大顺", "笑口常开，好运自来",
            "金玉满堂，富贵吉祥", "财运亨通，日进斗金", "招财进宝，生意兴隆",
            "鹏程万里，大展宏图", "事业有成，马到功成", "一帆风顺，心想事成",
            "福寿安康，百病不侵", "龙马精神，健康长寿", "平安喜乐，无病无灾",
            "阖家欢乐，幸福美满", "家和万事兴", "天伦之乐，其乐融融",
            "蛇年行大运，好事连连", "灵蛇报喜，福气东来", "金蛇狂舞，喜气洋洋",
            "紫气东来，万象更新", "春风得意，喜事连连", "否极泰来，时来运转",
            "锦上添花，好事成双", "花开富贵，竹报平安", "和气生财，顺风顺水",
            "大吉大利，诸事顺遂", "喜从天降，福自心生", "春回大地，福满乾坤",
            "瑞雪兆丰年", "新年新气象，好运滚滚来", "愿你所愿，终能实现"
        ];

        // ========================================
        // DOM元素
        // ========================================
        const apiKeyInput = document.getElementById('apiKeyInput');
        const saveApiBtn = document.getElementById('saveApiBtn');
        const apiStatus = document.getElementById('apiStatus');
        const apiStatusText = document.getElementById('apiStatusText');
        const modeAi = document.getElementById('modeAi');
        const modeRandom = document.getElementById('modeRandom');
        const aiFormCard = document.getElementById('aiFormCard');
        const randomCard = document.getElementById('randomCard');
        const resultCard = document.getElementById('resultCard');
        const resultContent = document.getElementById('resultContent');
        const generateAiBtn = document.getElementById('generateAiBtn');
        const generateRandomBtn = document.getElementById('generateRandomBtn');
        const copyResultBtn = document.getElementById('copyResultBtn');
        const regenerateBtn = document.getElementById('regenerateBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const randomWishText = document.getElementById('randomWishText');

        // ========================================
        // 状态
        // ========================================
        let apiKey = localStorage.getItem('zhipu_api_key') || '';
        let currentMode = 'ai';
        let lastRandomIndex = -1;
        let lastFormData = null;

        // 初始化API状态
        if (apiKey) {
            apiKeyInput.value = apiKey.slice(0, 8) + '****';
            apiStatus.classList.add('connected');
            apiStatusText.textContent = '已配置';
        }

        // ========================================
        // API Key保存
        // ========================================
        saveApiBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key && !key.includes('****')) {
                apiKey = key;
                localStorage.setItem('zhipu_api_key', key);
                apiKeyInput.value = key.slice(0, 8) + '****';
                apiStatus.classList.add('connected');
                apiStatusText.textContent = '已配置';
            }
        });

        // ========================================
        // 模式切换
        // ========================================
        function switchMode(mode) {
            currentMode = mode;
            modeAi.classList.toggle('active', mode === 'ai');
            modeRandom.classList.toggle('active', mode === 'random');
            aiFormCard.style.display = mode === 'ai' ? 'block' : 'none';
            randomCard.classList.toggle('visible', mode === 'random');
            resultCard.classList.remove('visible');
        }

        modeAi.addEventListener('click', () => switchMode('ai'));
        modeRandom.addEventListener('click', () => switchMode('random'));

        // ========================================
        // 随机祝福生成
        // ========================================
        function generateRandomWish() {
            let idx;
            do {
                idx = Math.floor(Math.random() * randomWishes.length);
            } while (idx === lastRandomIndex && randomWishes.length > 1);
            lastRandomIndex = idx;

            randomWishText.classList.remove('placeholder');
            randomWishText.textContent = randomWishes[idx];
            randomWishText.style.animation = 'none';
            randomWishText.offsetHeight;
            randomWishText.style.animation = 'fadeInUp 0.4s var(--ease-spring)';
        }

        generateRandomBtn.addEventListener('click', generateRandomWish);

        // ========================================
        // 获取表单数据
        // ========================================
        function getFormData() {
            return {
                name: document.getElementById('recipientName').value.trim(),
                gender: document.querySelector('input[name="gender"]:checked')?.value || '',
                relationship: document.getElementById('relationship').value,
                traits: document.getElementById('traits').value.trim(),
                memory: document.getElementById('memory').value.trim(),
                wishes: document.getElementById('wishes').value.trim(),
                style: document.querySelector('input[name="style"]:checked')?.value || '温馨'
            };
        }

        // ========================================
        // 构建Prompt
        // ========================================
        function buildPrompt(data) {
            let prompt = `你是一位擅长撰写新年祝福语的文案专家。请根据以下信息，为用户撰写一段真挚、有温度的蛇年新年祝福语。

【祝福对象信息】
- 称呼：${data.name}
- 关系：${data.relationship}`;

            if (data.gender) prompt += `\n- 性别：${data.gender}`;
            if (data.traits) prompt += `\n- 特点/爱好：${data.traits}`;
            if (data.memory) prompt += `\n- 难忘回忆：${data.memory}`;
            if (data.wishes) prompt += `\n- 新年期望：${data.wishes}`;

            prompt += `\n\n【风格要求】
- 风格：${data.style}
- 字数：100-200字
- 要求：
  1. 开头要有称呼
  2. 融入蛇年元素（如：金蛇、灵蛇、蛇年等）
  3. 结合对方特点和你们的关系，让祝福更有针对性
  4. 如果有难忘回忆，可以适当提及
  5. 结尾要有美好祝愿
  6. 语言自然流畅，避免过于套路化

请直接输出祝福语内容，不要有任何解释或前缀。`;

            return prompt;
        }

        // ========================================
        // 调用智谱API
        // ========================================
        async function callZhipuAPI(prompt) {
            const response = await fetch('https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'glm-4-flash',
                    messages: [{ role: 'user', content: prompt }],
                    temperature: 0.8,
                    max_tokens: 500
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || '请求失败');
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // ========================================
        // 显示结果
        // ========================================
        function showResult(text) {
            resultContent.textContent = text;
            resultContent.classList.remove('animate');
            resultContent.offsetHeight;
            resultContent.classList.add('animate');
            resultCard.classList.add('visible');
            resultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        // ========================================
        // AI祝福生成
        // ========================================
        async function generateAiWish() {
            const data = getFormData();

            // 验证必填项
            if (!data.name) {
                alert('请填写祝福对象的姓名/称呼');
                document.getElementById('recipientName').focus();
                return;
            }
            if (!data.relationship) {
                alert('请选择与祝福对象的关系');
                document.getElementById('relationship').focus();
                return;
            }
            if (!apiKey) {
                alert('请先配置智谱API Key');
                apiKeyInput.focus();
                return;
            }

            lastFormData = data;
            loadingOverlay.classList.add('visible');

            try {
                const prompt = buildPrompt(data);
                const result = await callZhipuAPI(prompt);
                showResult(result);
            } catch (error) {
                alert('生成失败：' + error.message);
            } finally {
                loadingOverlay.classList.remove('visible');
            }
        }

        generateAiBtn.addEventListener('click', generateAiWish);

        // ========================================
        // 重新生成
        // ========================================
        regenerateBtn.addEventListener('click', () => {
            if (currentMode === 'ai' && lastFormData) {
                generateAiWish();
            } else {
                generateRandomWish();
            }
        });

        // ========================================
        // 复制功能
        // ========================================
        copyResultBtn.addEventListener('click', async () => {
            const text = resultContent.textContent;
            if (!text) return;

            try {
                await navigator.clipboard.writeText(text);
                copyResultBtn.classList.add('success');
                copyResultBtn.querySelector('span').textContent = '已复制';
                setTimeout(() => {
                    copyResultBtn.classList.remove('success');
                    copyResultBtn.querySelector('span').textContent = '复制';
                }, 2000);
            } catch (err) {
                const range = document.createRange();
                range.selectNodeContents(resultContent);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });
    </script>
</body>
</html>
